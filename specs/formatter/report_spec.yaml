describe report:
- before:
    preamble = "describe report:\n- it is pending:"


- context with empty example:
  - it exits with zero status:
      expect (run_spec (preamble)).to_exit (0)
  - it reports no expectations:
      expect (run_spec (preamble)).to_output_containing "No expectations met."
  - it reports a pending example:
      expect (run_spec (preamble)).to_output_containing ", 1 pending "


- context with pending call from empty example:
  - before:
      yaml = preamble .. "\n    pending ()"

  - context in non-verbose mode:
    - it exits with zero status:
        expect (run_spec (yaml, args)).to_exit (0)
    - it reports no expectations:
        expect (run_spec (yaml, args)).to_output_containing "No expectations met."
    - it reports the pending example:
        expect (run_spec (yaml, args)).to_output_matching ", 1 pending "
    - it appends pending suffix to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is pending %(PENDING example: not yet implemented%)\n"
        )
    - it lists pending example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of pending expectations:\n" ..
          "%- report is pending: %(PENDING example: not yet implemented%)\n"
        )

  - context in verbose mode:
    - before: args = "-v"
    - it exits with zero status:
        expect (run_spec (yaml, args)).to_exit (0)
    - it reports no expectations:
        expect (run_spec (yaml, args)).to_output_containing "No expectations met."
    - it reports the pending example:
        expect (run_spec (yaml, args)).to_output_matching ", 1 pending "
    - it appends pending suffix to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is pending %(PENDING example: not yet implemented%)\n"
        )
    - it lists pending example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of pending expectations:\n" ..
          "%- report is pending: %(PENDING example: not yet implemented%)\n"
        )


- context with pending argument from empty example:
  - before: |
      yaml = preamble .. "\n    pending 'see issue 123'"

  - context in non-verbose mode:
    - it exits with zero status:
        expect (run_spec (yaml, args)).to_exit (0)
    - it reports no expectations:
        expect (run_spec (yaml, args)).to_output_containing "No expectations met."
    - it reports the pending example:
        expect (run_spec (yaml, args)).to_output_matching ", 1 pending "
    - it appends pending suffix to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is pending %(PENDING example: see issue 123%)\n"
        )
    - it lists pending example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of pending expectations:\n" ..
          "%- report is pending: %(PENDING example: see issue 123%)\n"
        )

  - context in verbose mode:
    - before: args = "-v"
    - it exits with zero status:
        expect (run_spec (yaml, args)).to_exit (0)
    - it reports no expectations:
        expect (run_spec (yaml, args)).to_output_containing "No expectations met."
    - it reports the pending example:
        expect (run_spec (yaml, args)).to_output_matching ", 1 pending "
    - it appends pending suffix to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is pending %(PENDING example: see issue 123%)\n"
        )
    - it lists pending example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of pending expectations:\n" ..
          "%- report is pending: %(PENDING example: see issue 123%)\n"
        )


- context with pending argument before expectation:
  - before: |
      yaml = preamble .. "\n" ..
             "    pending 'see issue 123'\n" ..
             "    expect (1).to_be (0)\n"

  - context in non-verbose mode:
    - it exits with zero status:
        expect (run_spec (yaml, args)).to_exit (0)
    - it reports no expectations:
        expect (run_spec (yaml, args)).to_output_containing "No expectations met."
    - it reports the pending example:
        expect (run_spec (yaml, args)).to_output_matching ", 1 pending "
    - it appends pending suffix to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is pending %(1 pending%)\n"
        )
    - it lists pending example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of pending expectations:\n" ..
          "%- report is pending:\n" ..
          "  PENDING expectation 1: see issue 123\n"
        )

  - context in verbose mode:
    - before: args = "-v"
    - it exits with zero status:
        expect (run_spec (yaml, args)).to_exit (0)
    - it reports no expectations:
        expect (run_spec (yaml, args)).to_output_containing "No expectations met."
    - it reports the pending example:
        expect (run_spec (yaml, args)).to_output_matching ", 1 pending "
    - it appends pending summary to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is pending\n" ..
          "    %-:3:1: PENDING expectation 1: see issue 123\n"
        )
    - it lists pending example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of pending expectations:\n" ..
          "%- report is pending:\n" ..
          "  %-:3:1: PENDING expectation 1: see issue 123\n"
        )

- context with failing expectation:
  - before:
      yaml = "describe report:\n" ..
             "- it is failing:\n" ..
             "    expect (1).to_be (0)\n"

  - context in non-verbose mode:
    - it exits with non-zero status:
        expect (run_spec (yaml, args)).not_to_exit (0)
    - it reports 0% expectations met:
        expect (run_spec (yaml, args)).
          to_output_containing "Met 0.00% of 1 expectations."
    - it reports the failing example:
        expect (run_spec (yaml, args)).to_output_matching " 1 failed "
    - it appends failing suffix to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is failing %(1 failing%)\n"
        )
    - it lists failing example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of failed expectations:\n" ..
          "%- report is failing:\n" ..
          "  FAILED expectation 1: expecting exactly 0, but got 1\n"
        )

  - context in verbose mode:
    - before: args = "-v"
    - it exits with non-zero status:
        expect (run_spec (yaml, args)).not_to_exit (0)
    - it reports 0% expectations met:
        expect (run_spec (yaml, args)).
          to_output_containing "Met 0.00% of 1 expectations."
    - it reports the failing example:
        expect (run_spec (yaml, args)).to_output_matching " 1 failed "
    - it appends failing summary to the example output: |
        expect (run_spec (yaml, args)).to_output_matching (
          "report\n" ..
          "  is failing\n" ..
          "    %-:3:1: FAILED expectation 1:\n" ..
          "    expecting exactly 0, but got 1\n"
        )
    - it lists failing example in report summary: |
        expect (run_spec (yaml, args)).to_output_matching (
          "Summary of failed expectations:\n" ..
          "%- report is failing:\n" ..
          "  %-:3:1: FAILED expectation 1:\n" ..
          "  expecting exactly 0, but got 1\n"
        )
